"use strict";async function loadIP(e=""){fetch("lng/ru.json").then(e=>e.json()).catch(()=>sessionStorage.setItem("lng","0")).then(e=>{const t=sessionStorage.getItem("ruslng"),n=JSON.stringify(e);t&&t===n||(sessionStorage.setItem("ruslng",JSON.stringify(e)),sessionStorage.setItem("lng","1"))});try{let t=`https://ipapi.co/${e}/${ipField}/`,n=await fetch(t);if(!n.ok)throw`Looks like there was a problem. Status Code: ${n.status}`;let o=await n.json(),r=checkError(o);treatment(firstTreatment(r))}catch(e){let t=document.createElement("span");console.error(e),t.classList.add("error","message--blink"),t.textContent=e,block.innerHTML="",block.append(t),setTimeout(blink,500,3,t)}}function checkError(e){if(e.error){switch(e.reserved){case!0:e.reason="Зарезервированный IP-адрес";break;default:e.reason="Неверный IP-адрес"}return{ip:e.ip,error:e.error,reason:e.reason}}for(let t in e)null!==e[t]&&void 0!==e[t]||delete e[t];return e}function firstTreatment(e){return e.error?delete e.error:(e.country_name&&e.country_code&&(e.country=e.country_name+" | "+e.country_code),e.latitude&&e.longitude&&(e.latitude=e.latitude+", "+e.longitude),e.timezone&&e.utc_offset&&(e.timezone=e.timezone+` (${e.utc_offset})`),delete e.country_code,delete e.country_name,delete e.longitude,delete e.utc_offset),e}function treatment(e){let{ip:t}=e,n=Object.entries(e);inputAddress.placeholder=t,n.forEach(([e,t])=>blockFragment.append(rowCreate(e,t))),block.innerHTML="",block.append(blockFragment)}function rowCreate(e,t){let n=document.createElement("div");return n.classList.add("ipaddress__row"),n.insertAdjacentHTML("beforeend",`<span class="ipaddress__item ipaddress__item--title">${+sessionStorage.getItem("lng")?translater(e):e}</span><span class="ipaddress__item ipaddress__item--text">${t}</span>`),n}function translater(e){const t={get:(e,t)=>t in e?e[t]:t};let n=JSON.parse(sessionStorage.getItem("ruslng"));return n=new Proxy(n,t),n[e]}function copyCell(e){navigator.clipboard?navigator.clipboard.writeText(e.textContent).catch(e=>console.error(e)):window.getSelection()?(document.getSelection().selectAllChildren(e),document.execCommand("copy"),document.getSelection().empty()):document.body.createTextRange&&(range=document.body.createTextRange(),range.moveToElementText(e),range.select(),document.execCommand("copy")),document.getSelection().selectAllChildren(e)}function blink(e,t){t.classList.toggle("message--blink");let n=setTimeout(blink,500,++e,t);8===e&&clearTimeout(n)}function reloadIP(e){e.preventDefault(),e.stopPropagation(),/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.test(inputAddress.value)||(inputAddress.value=""),loadIP(inputAddress.value),inputAddress.blur()}const block=document.querySelector(".ipaddress__info"),blockFragment=new DocumentFragment,inputForm=document.forms.ipaddress,inputAddress=inputForm.address,inputButton=inputForm.button,ipInfo=document.getElementsByClassName("ipaddress__info")[0],ipField="json";window.onload=loadIP(),inputButton.onclick=reloadIP,inputAddress.onkeydown=(e=>{e.stopPropagation(),"Enter"!=e.code&&"NumpadEnter"!=e.code||(e.preventDefault(),inputButton.click()),"Escape"==e.code&&(e.preventDefault(),inputAddress.blur())}),ipInfo.ondblclick=(e=>{e.stopPropagation(),e.target.closest(".ipaddress__item--text")?copyCell(e.target):document.getSelection().empty()});{let e;inputForm.addEventListener("focusin",t=>{t.target.hasAttribute("placeholder")&&(e=t.target.placeholder,t.target.placeholder=""),t.stopPropagation()}),inputForm.addEventListener("focusout",t=>{t.target.hasAttribute("placeholder")&&(t.target.placeholder=e),t.stopPropagation()})}